<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Do script ao pacote de R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Andrea SÃ¡nchez-Tapia   NÃºcleo de ComputaÃ§Ã£o CientÃ­fica e Geoprocessamento   Jardim BotÃ¢nico do Rio de Janeiro" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Do <em>script</em> ao pacote de R
## um exemplo desde a biologia
### Andrea SÃ¡nchez-Tapia <br> NÃºcleo de ComputaÃ§Ã£o CientÃ­fica e Geoprocessamento <br> Jardim BotÃ¢nico do Rio de Janeiro
### 20-07-2020

---

background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px


### ApresentaÃ§Ã£o


+ BiÃ³loga - Universidade Nacional da ColÃ´mbia  
+ Mestre em Ecologia - UFRJ
+ Doutora em BotÃ¢nica - JBRJ
+ .purple[PÃ³s-doc - NÃºcleo de ComputaÃ§Ã£o CientÃ­fica e Geoprocessamento do JBRJ]

Ecologia de comunidades vegetais, restauraÃ§Ã£o ecolÃ³gica, ecologia quantitativa  

__InformÃ¡tica da biodiversidade__, modelagem de nicho ecolÃ³gico

__CiÃªncia aberta e reprodutÃ­vel__, Ã©tica na ciÃªncia de dados, ciÃªncia de dados feminista



---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### ApresentaÃ§Ã£o

+ Como trabalhar apenas com software _libre_? 

+ UsuÃ¡ria de `R` desde 2009

+ __O alvo hoje__: Executar e ensinar a fazer projetos de anÃ¡lise reprodutÃ­veis. Desde o download e processamento de dados atÃ© produzir o manuscrito, relatÃ³rio ou apresentaÃ§Ã£o (__`rmarkdown`__, __`knitr`__)

+ R-Ladies+ Rio desde 2016 

 &lt;!-- + Co-fundadora de .red[__Â¡liibre!__] com Sara Mortara (R-Ladies+ Rio): laboratÃ³rio de informÃ¡tica da biodiversidade e reprodutibilidade em ecologia--&gt; 

---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px


### Curso sobre ciÃªncia aberta e fluxos de trabalho reprodutÃ­veis

.pull-left[
&lt;img src="./figs/turma.JPG" width="300" /&gt;


&lt;img src="./figs/logo_jbrj.png" width="100" /&gt;
]

.pull-right[

__Boas prÃ¡ticas__ em anÃ¡lise de dados

&lt;img src="./figs/rstudio.jpg" width="200" /&gt;

&lt;img src="./figs/logo-git.png" width="80" /&gt;&lt;img src="./figs/GitHub_Logo.png" width="80" /&gt;&lt;img src="./figs/btibucket.png" width="80" /&gt;&lt;img src="./figs/gitlab-logo-gray-rgb.png" width="80" /&gt;

&lt;img src="./figs/latex.jpeg" width="100" /&gt;&lt;img src="./figs/bibtex.jpeg" width="100" /&gt;&lt;img src="./figs/zotero.svg" width="100" /&gt;
&lt;img src="./figs/rmarkdown.png" width="50" /&gt;

&lt;img src="./figs/xaringan.png" width="60" /&gt;
]


 &lt;!-- pensada como seminÃ¡rio
 alunes de vÃ¡rias Ã¡reas do conhecimento
 ferramentas que nÃ£o tÃªm um ensino formal
 de grande utilidade --&gt; 

---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### Por que a Ãªnfase em reprodutibilidade?

+ TransparÃªncia
+ Portabilidade - colaboraÃ§Ã£o!
+ CorreÃ§Ã£o de erros `-&gt;` robusteza
+ ComunicaÃ§Ã£o

Para criar um pacote de R precisa ser todas estas coisas

### Mas _bem antes_ de chegar ao pacote tambÃ©m Ã© bom implementar estas boas prÃ¡ticas!


---
class: middle
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### Pacote de R para modelagem de nicho &lt;br&gt; ecolÃ³gico: .red[modleR]

+ __Unificar__ diferentes partes do processo de MNE
+ Fornecer __metadados__ e __documentar__ decisÃµes de parametrizaÃ§Ã£o
+ Se __integrar__ ao resto de ferramentas que existem no ambiente de `R`

&lt;br&gt;
&lt;img src="./figs/mm.png" width="151" /&gt;
&lt;img src="./figs/coleguinhes.png" width="600" /&gt;

&lt;small&gt;
Marinez F Siqueira, Sara Mortara, Diogo Rocha, Guilherme Gall, Felipe SodrÃ©
&lt;/small&gt;

.pull-left[

<i class="fab  fa-firefox "></i> 
&lt;small&gt;
[https://model-r.github.io/modleR/](https://model-r.github.io/modleR/)
&lt;/small&gt;
]

.pull-right[
&lt;p style="text-align:center;"&gt;

<i class="fab  fa-youtube "></i> 

&lt;small&gt;
&lt;a href="https://www.youtube.com/watch?v=4Xw33TdIVXA"&gt;Aula no curso ENM-2020&lt;/a&gt;

&lt;/small&gt;
&lt;/p&gt;

]

---
class: bottom, center
background-image: url("figs/modleR.png")
background-position: 50% 0%
background-size: 800px

&lt;img src="./figs/preprint.png" width="800" /&gt;


---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### Modelos de nicho ecolÃ³gico ou de &lt;br&gt; distribuiÃ§Ã£o das espÃ©cies (ENM, SDM)

+ Dados de ocorrÃªncia das espÃ©cies: __objetos espaciais__, bases de dados, limpeza de dados.

+ Camadas preditoras ambientais ( __rasters__ de SIG)  Pacotes __`raster`__, __`sp`__, __`maps`__, __`rgdal`__: (taskview Spatial)

+ Abordagem de aprendizado estatÃ­stico 

+ Diferentes algoritmos
 
+ __InferÃªncia de Ã¡reas adequadas para a ocorrÃªncia das espÃ©cies__

---
class: inverse, middle, center
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### A gente jÃ¡ conhecia algumas boas prÃ¡ticas



---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### Boas prÃ¡ticas â¤ï¸ &lt;br&gt; estrutura de pastas e pasta de trabalho 

+ _Meetup_ anterior! [link](https://www.youtube.com/watch?time_continue=1563&amp;v=4nfIbiS1Huw&amp;feature=emb_title) e arquivo .zip 

--

+ NÃ£o use `setwd()`! ğŸ”¥

--

+ NÃ£o mude de pasta de trabalho ao longo do projeto: use __caminhos relativos__

--
    
  + Caminhos absolutos: `"C://Eu/Minha_pasta/arquivo_meu_v_13.csv"`

--

  + Caminhos relativos: `"./data"`, `"./figs"`
  
--

 + O nÃ­vel acima Ã© com dois pontos: `..`

--

 + Uma pasta "do lado" Ã© uma subpasta desse nÃ­vel acima: `"../pasta_irmÃ£"`


---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### Boas prÃ¡ticas â¤ï¸ &lt;br&gt; estrutura de pastas e pasta de trabalho 

+ Cuide da estrutura de pastas
--

```bash
.
â”œâ”€â”€ codigo/    # Scripts em R
â”œâ”€â”€ dados/     # Dados 
â”œâ”€â”€ output/    # Outputs gerados a partir dos cÃ³digos
â”œâ”€â”€ figs/      # Figuras geradas a partir dos cÃ³digos
â”œâ”€â”€ docs/      # RelatÃ³rios reprodutÃ­veis a partir dos outputs
â”œâ”€â”€ *.Rproj    # Projeto de RStudio
â”œâ”€â”€ .gitignore # Lista dos arquivos e pastas que nÃ£o serÃ£o controlados
â””â”€â”€ README.md   
```
--

+ Abra as sessÃµes de R jÃ¡ na pasta de trabalho
--

 + Um atalho: usar o pacote __rprojroot__ ou __here__
--

 + Um atalho melhor: usar projetos de .blue[RStudio]

---
class: inverse, center, middle

# A histÃ³ria

---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### Primeira etapa: _scripts_ soltos

#### O trabalho: gerar uma camada de diversidade potencial de plantas &lt;br&gt; da Mata AtlÃ¢ntica

+ A "maior" quantidade possÃ­vel de espÃ©cies
+ Muito controle sobre a qualidade dos modelos
+ CorreÃ§Ã£o taxonÃ´mica, limpeza dos registros
+ Alta resoluÃ§Ã£o (30s ~1km)

--

#### O fluxo de trabalho: cada espÃ©cie precisa passar por vÃ¡rias etapas

+ ObtenÃ§Ã£o, __limpeza__ de dados
+ Desenho experimental, __preparaÃ§Ã£o__ dos dados
+ Ajustar os __modelos__, __projetar__ os modelos para vÃ¡rios algoritmos
+ Juntar os resultados dos diferentes algoritmos
+ Juntar o resultado para vÃ¡rias espÃ©cies

---
### Primeira etapa: _scripts_ soltos

+ Um script para __uma__ espÃ©cie (fazia todas as etapas de vez)

--

+ Um `"for loop"` para fazer para vÃ¡rias espÃ©cies

--

```r
lista_de_especies &lt;- c("sp1", "sp2", "sp3")
```

--

```r
for (especie in lista_de_especies) { # pode ter qualquer nome, i
    todo_o_codigo(especie)
}
```

--

```r
especie &lt;- sp1
todo_o_codigo(sp1)

especie &lt;- sp2
todo_o_codigo(sp2)

especie &lt;- sp3
todo_o_codigo(sp3)
```


---
background-image: url('figs/hadley.jpg')
background-size: 150px
background-position: 90% 10%

### Criar funÃ§Ãµes


"Se vocÃª estÃ¡ copiando e colando seu cÃ³digo mais   
de trÃªs vezes, Ã© hora de escrever uma funÃ§Ã£o"

`Hadley Wickham`

--


```r
modelar &lt;- function(x) {
    y &lt;- ...(x)
    return(y)
}

# Uma espÃ©cie
modelar(especie)

# VÃ¡rias espÃ©cies
lapply(lista_de_especies, modelar)

purrr::map(lista_de_especies, 
           ~modelar)
```

--

#### A funÃ§Ã£o ainda rodava todas as etapas da anÃ¡lise para cada espÃ©cie!

---
background-image: url('figs/alltest_alphamap1.png')
background-position: 95% 50%
background-size: 45%
class: inverse

### Rodava!  
--

### Matava a RAM :/
--

### Demorava 10 dias Â¬Â¬ 
--

### Fazia uma espÃ©cie apÃ³s &lt;br&gt; a outra

--

&lt;img src="figs/felipe.png" width="70" /&gt;

Felipe SodrÃ©


---
background-image: url('./figs/lncc.png')
background-size: 300px
background-position: 90% 10%

### Segunda etapa

+ Capacidade de computaÃ§Ã£o 
+ ComputaÃ§Ã£o remota (VPN, ssh)
+ __ParalelizaÃ§Ã£o__ 
  + Separar os quatro processos em funÃ§Ãµes diferentes
+ Escrever cÃ³digo em colaboraÃ§Ã£o: 
  + Cuidar do __estilo de cÃ³digo__ 
  + __ComeÃ§ar a usar controle de versÃµes__ (git/GitHub)


--


![Wa](figs/math.gif)


---
### ParalelizaÃ§Ã£o

+ Cada processo vai para um _core_ (os computadores de hoje tÃªm 4 _cores_)
+ Os _clusters_ de computaÃ§Ã£o podem ter vÃ¡rias centenas de _cores_
+ HÃ¡ vÃ¡rias maneiras de paralelizar processos em R

```r
library(parallel)
library(snowfall)
library(foreach)
library(futures)
```

```r
sfInit(parallel = T, cpus = 3)
sfExportAll() # para que cada nÃºcleo receba as variÃ¡veis do workspace
sfLapply(lista_de_especies, modelar)
sfStop()
```

### Passou de 10 dias para algumas horas Â¬Â¬


---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### __Modularizar__ o cÃ³digo

+ Cada core ainda executava o processo inteiro

+ E se a gente rodasse um processo por vez para todas as espÃ©cies? 

+ Na hora de repetir nÃ£o precisava voltar atÃ© o inÃ­cio

+ Quatro funÃ§Ãµes!


---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px
### Controle de versÃµes: Git e GitHub

&lt;img src="./figs/logo-git.png" width="80" /&gt;&lt;img src="./figs/GitHub_Logo.png" width="80" /&gt;&lt;img src="./figs/btibucket.png" width="80" /&gt;&lt;img src="./figs/gitlab-logo-gray-rgb.png" width="80" /&gt;

+ Git Ã© o programa que lida localmente
+ O GitHub Ã© um portal remoto, existem outros (BitBucket, Gitlab)

---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### Git: baseado em __commits__

&lt;img src="./figs/snapshots.png" width="600" /&gt;

.footnote[
[https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control](https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control)
]

---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### Git: modo diff

&lt;img src="figs/diff.png" width="600" /&gt;

.footnote[
[https://git-scm.com/book/en/v2/Getting-Started-Git-Basics](https://git-scm.com/book/en/v2/Getting-Started-Git-Basics)
]

---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px

### Git: local e remoto

&lt;img src="figs/areas.png" width="600" /&gt;

.footnote[
[https://git-scm.com/book/en/v2/Getting-Started-Git-Basics](https://git-scm.com/book/en/v2/Getting-Started-Git-Basics)
]

---
background-image: url("figs/chevron.png")
background-position: 98% 2%
background-size: 150px
### We â¤ï¸ &lt;img src="figs/logo-git.png" width="70" /&gt;


+ Backup

--

+ Controle de versÃµes

--

+ Reprodutibilidade

--

+ Workflow colaborativo

--

+ TransparÃªncia


#### Ã‰ preciso padronizar o jeito de escrever o cÃ³digo!*

---
background-image: url('figs/hadley.jpg')
background-size: 150px
background-position: 90% 10%

### Estilo de cÃ³digo

"Um bom estilo de cÃ³digo Ã© como usar uma boa pontuaÃ§Ã£o. &lt;br&gt;  VocÃª pode viver sem ela mas sem dÃºvida facilita ler as coisas." 

Hadley Wickham


+ [Google's R style guide](https://google.github.io/styleguide/Rguide.html)
+ [tidyverse](https://style.tidyverse.org/)
+ [Advanced R](http://adv-r.had.co.nz/Style.html)

Independente do estilo, o que importa Ã© ser consistente!

`Ctrl+Shift+A` Reformata o cÃ³digo automaticamente

pacote __formatR__ 


---
background-image: url("figs/rpackages.png")
background-size: 300px
background-position: 90% 50%

### Terceira etapa: TransformaÃ§Ã£o em pacote


&lt;img src="figs/guilherme.png" width="90" /&gt;
Guilherme Gall (LNCC)

--

+ Estrutura especial das pastas
+ DocumentaÃ§Ã£o especÃ­fica
+ LicenÃ§a
+ "Vignettes"
+ DocumentaÃ§Ã£o cuidadosa
+ Passar testes!
+ SubmissÃ£o a CRAN _`#medo`_

--

#### Pacotes para ajudar:
+ `devtools`  
+ `roxygen2`  



---
### Estrutura de um pacote de R

```bash
.
â”œâ”€â”€ R/           # FunÃ§Ãµes
â”œâ”€â”€ man/         # DocumentaÃ§Ã£o
â”œâ”€â”€ data/        # Dados
â”œâ”€â”€ vignettes/   # Vignettes
â”œâ”€â”€ inst/        # Os manuais que ficam quando vocÃª instala
â”œâ”€â”€ .buildignore # Arquivos e pastas que nÃ£o serÃ£o controlados
â”œâ”€â”€ DESCRIPTION  # DescriÃ§Ã£o do pacote
â”œâ”€â”€ NAMESPACE    # NAMESPACE
â””â”€â”€ README.md    # README
```

+ O prÃ³prio pacote pode ser criado usando as opÃ§Ãµes de RStudio
+ O pacote __usethis__ (funÃ§Ã£o `usethis::create_package()`)
+ Alguns elementos sÃ£o obrigatÃ³tios (DESCRIPTION, NAMESPACE, R, man)

---
### R e data

```bash
.
*â”œâ”€â”€ R/           # FunÃ§Ãµes
*â”œâ”€â”€ man/         # DocumentaÃ§Ã£o
*â”œâ”€â”€ data/        # Dados
â”œâ”€â”€ vignettes/   # Vignettes
â”œâ”€â”€ inst/        # RelatÃ³rios reprodutÃ­veis a partir dos outputs
â”œâ”€â”€ .buildignore # Arquivos e pastas que nÃ£o serÃ£o controlados
â”œâ”€â”€ DESCRIPTION  # DescriÃ§Ã£o do pacote
â”œâ”€â”€ NAMESPACE    # NAMESPACE
â””â”€â”€ README.md    # README
```

+ As __funÃ§Ãµes__ estÃ£o na pasta `R/`
+ A documentaÃ§Ã£o das funÃ§Ãµes estarÃ¡ em `man/`
+ Os __dados__ estarÃ£o na pasta `data/` `(data(cars)`)

---
### DESCRIPTION

```bash
.
â”œâ”€â”€ R/           # FunÃ§Ãµes
â”œâ”€â”€ man/         # DocumentaÃ§Ã£o
â”œâ”€â”€ data/        # Dados
â”œâ”€â”€ vignettes/   # Vignettes
â”œâ”€â”€ inst/        # RelatÃ³rios reprodutÃ­veis a partir dos outputs
â”œâ”€â”€ .buildignore # Arquivos e pastas que nÃ£o serÃ£o controlados
*â”œâ”€â”€ DESCRIPTION  # DescriÃ§Ã£o do pacote
â”œâ”€â”€ NAMESPACE    # NAMESPACE
â””â”€â”€ README.md    # README
```

&lt;small&gt;
A DESCRIPTION do pacote Ã© editada a mÃ£o. 
```
Package: rladiesrio
Type: Package
Title: Isto Ã© um esqueleto de pacote de teste
Version: 0.1.0
Author: RLadies+ Rio de Janeiro
Maintainer: Andrea SÃ¡nchez-Tapia &lt;andreasancheztapia@gmail.com&gt;
Description: Este esqueleto permite entender a estrutura de um pacote. 
License: MIT
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.1.0
```
&lt;/small&gt;
---
### NAMESPACE

```bash
.
â”œâ”€â”€ R/           # FunÃ§Ãµes
â”œâ”€â”€ man/         # DocumentaÃ§Ã£o
â”œâ”€â”€ data/        # Dados
â”œâ”€â”€ vignettes/   # Vignettes
â”œâ”€â”€ inst/        # RelatÃ³rios reprodutÃ­veis a partir dos outputs
â”œâ”€â”€ .buildignore # Arquivos e pastas que nÃ£o serÃ£o controlados
â”œâ”€â”€ DESCRIPTION  # DescriÃ§Ã£o do pacote
*â”œâ”€â”€ NAMESPACE    # NAMESPACE
â””â”€â”€ README.md    # README
```
O NAMESPACE indica quais funÃ§Ãµes serÃ£o __importadas__ ou __exportadas__ pelo pacote

```
*# Generated by roxygen2: do not edit by hand

export(create_buffer)
export(do_any)
import(graphics)
import(raster)
importFrom(Rdpack,reprompt)
importFrom(dismo,randomPoints)
```

---
### __roxygen2__ e a documentaÃ§Ã£o das funÃ§Ãµes

```bash
.
â”œâ”€â”€ R/           # FunÃ§Ãµes
*â”œâ”€â”€ man/         # DocumentaÃ§Ã£o
â”œâ”€â”€ data/        # Dados
â”œâ”€â”€ vignettes/   # Vignettes
â”œâ”€â”€ inst/        # RelatÃ³rios reprodutÃ­veis a partir dos outputs
â”œâ”€â”€ .buildignore # Arquivos e pastas que nÃ£o serÃ£o controlados
â”œâ”€â”€ .gitignore   # Arquivos e pastas que serÃ£o ignorados por git
â”œâ”€â”€ *.Rproj      # Projeto de RStudio
â”œâ”€â”€ DESCRIPTION  # DescriÃ§Ã£o do pacote
â”œâ”€â”€ NAMESPACE    # NAMESPACE
â””â”€â”€ README.md    # README
```

+ Antes era preciso escrever Ã  mÃ£o a documentaÃ§Ã£o, o NAMESPACE e a DESCRIPTION.
+ Hoje: os parÃ¢metros das funÃ§Ãµes podem ser documentados diretamente nos arquivos em R/ com um mÃ©todo diferente: `#'` e indicando os parÃ¢metros, e as funÃ§Ãµes de pacotes que serÃ£o usadas 

---
### __roxygen2__ e a documentaÃ§Ã£o das funÃ§Ãµes

```
#' Titulo da funcao
#'
#' descricao
#'
#' @param parametro1 descriÃ§Ã£o do parÃ¢metro1
#' @param parametro2 descriÃ§Ã£o do parÃ¢metro2
#' @Import pacote
#' @ImportFrom pacote funcao funcao funcao
#' @details
#' @returns um data.frame
*#' @export #para que entre no NAMESPACE
#' @examples
um exemplo reprodutÃ­vel, curto
funcao &lt;- function(x) {
funfunfun
}
```
+ OpÃ§Ã£o `code &gt; Insert Roxygen Skeleton` no menu de RStudio
+ Quando a documentaÃ§Ã£o Ã© escrita: `devtools::document()`
+ Vai criar os arquivos em man/ e editar o NAMESPACE

---
### Outras formas de documentaÃ§Ã£o: vignettes e README

```bash
.
â”œâ”€â”€ R/           # FunÃ§Ãµes
â”œâ”€â”€ man/         # DocumentaÃ§Ã£o
â”œâ”€â”€ data/        # Dados
*â”œâ”€â”€ vignettes/   # Vignettes
â”œâ”€â”€ inst/        # RelatÃ³rios reprodutÃ­veis a partir dos outputs
â”œâ”€â”€ .buildignore # Aqui tem que estar README.Rmd que Ã© um arquivo opcional
â”œâ”€â”€ DESCRIPTION  # DescriÃ§Ã£o do pacote
â”œâ”€â”€ NAMESPACE    # NAMESPACE
*â”œâ”€â”€ README.Rmd    # README em rmarkdown que Ã© knittado para criar o md
*â””â”€â”€ README.md    # README
```

+ README e vignettes sÃ£o arquivos de rmarkdown que sÃ£o knittados 

&lt;img src="./figs/rmarkdown.png" width="100" /&gt;

---
### __.buildignore__ permite ignorar arquivos fora do padrÃ£o ou que ainda nÃ£o estÃ£o prontos

```bash
.
â”œâ”€â”€ R/           # FunÃ§Ãµes
â”œâ”€â”€ man/         # DocumentaÃ§Ã£o
â”œâ”€â”€ data/        # Dados
â”œâ”€â”€ vignettes/   # Vignettes
â”œâ”€â”€ inst/        # RelatÃ³rios reprodutÃ­veis a partir dos outputs
*â”œâ”€â”€ .buildignore # Aqui tem que estar README.Rmd que Ã© um arquivo opcional
â”œâ”€â”€ DESCRIPTION  # DescriÃ§Ã£o do pacote
â”œâ”€â”€ NAMESPACE    # NAMESPACE
*â”œâ”€â”€ README.Rmd    # README em rmarkdown que Ã© knittado para criar o md
â””â”€â”€ README.md    # README
```
---
background-image: url("figs/testthat.png")
background-position: 98% 2%
background-size: 150px


### Checando o pacote


+ Pacote __testthat__ para criar testes formais com expectativas

+ Para checar se o pacote estÃ¡ funcionando: `devtools::load_all()` sem precisar instalar mas vai contar se pode ser usado
+ Quando o pacote foi terminado: hora dos tests! `devtools::check()`
+ Vai rodar os tests de CRAN e fazer um diagnÃ³stico do pacote. 
+ Quando estÃ¡ passando tests ğŸ‰

![](figs/tests.png)

+ Pode mandar para GitHub e __o pacote pode ser instalado desde GitHub__

`remotes::install_github("Model-R/modelr_pkg", build_vignettes = TRUE)`

--

---
background-image: url("figs/usethis.png")
background-position: 98% 2%
background-size: 150px

### Fluxos automatizados : __usethis__

---
background-image: url("figs/testthat.png")
background-position: 98% 2%
background-size: 150px

### Tests formais: __testthat__

---
background-image: url("figs/pkgdown-logo.png")
background-position: 98% 2%
background-size: 150px
### Uma pÃ¡gina para o seu pacote: __pkgdown__

&lt;img src="./figs/pkgdown.png" width="350" /&gt;

+ `pkgdown::build_site()` vai knittar tudo em formato de pÃ¡gina web e colocar em uma pasta __docs/__ do pacote
+ O repositÃ³rio de GitHub tem que estar configurado para fazer uma pÃ¡gina a partir dessa pasta
+ O readme ou um index.md serÃ£o a primeira pÃ¡gina
+ A vignette principal irÃ¡ em Get started
+ Vignettes adicionais __que nÃ£o estÃ£o no pacote__ devem ir em vignettes/articles e irÃ£o na aba Articles

---
### LiÃ§Ãµes nestes anos

+ Trabalho colaborativo entre instituiÃ§Ãµes e Ã¡reas do conhecimento (JBRJ, LNCC, IIS)
+ Boas perguntas
+ Limpeza de dados!
+ PaciÃªncia
+ Controle de versÃµes, Ãªnfase na documentaÃ§Ã£o
+ Testes pelos usuÃ¡rios (VersÃ£o web/php OK, falta muito trabalho no teste direto do pacote)

---
### Sobre qualquer _script_ em geral

.pull-left[
`NÃ£o`
+ Use `setwd()` e a mesma sessÃ£o para diferentes projetos
+ Use pastas absolutas (`"C://Eu/Minha_pasta/"`)
+ Dependa do workspace: chega de salvar e carregar o `.RData`.
]

.pull-right[
`Sim`
+ Use os projetos de RStudio! (`.RProj`) 
+ Em vez disso `("aqui", "./subpasta","../pasta do lado")` 
+ E escreva arquivos de output e leia-os
+ Invista em aprender a usar __git__ e __github__ ou __bitbucket.__
+ Documente e comente tudo o que puder
+ Use um padrÃ£o de cÃ³digo (espaÃ§os, indentaÃ§Ã£o, etc...)
]

---
### Sobre a criaÃ§Ã£o de pacotes

+ Pense bem se vale a pena fazer o pacote ğŸ¤” ManutenÃ§Ã£o, atualizaÃ§Ã£o e comunidade de usuÃ¡ries.
--

+ Pense bem nos fluxos de trabalho: quantas funÃ§Ãµes, o que entra em cada fase? o que sai? Modularize
--

+ Separe os problemas de cÃ³digo e resolva para um caso sÃ³
--

+ Convirta o cÃ³digo em funÃ§Ãµes (o "_for loop_" Ã© um passo intermediÃ¡rio)
--


+ Invista em aprender sobre __git__ e __GitHub__/__Gitlab__/__Bitbucket__
--


+ NÃ£o faÃ§a do zero: use __roxygen2__, __devtools__, __usethis__, __testthat__
--

+ Cuide da documentaÃ§Ã£o e crie vignettes e exemplos (por definiÃ§Ã£o eles terÃ£o de ser reprodutÃ­veis)
--

+ Crie uma pÃ¡gina web com  __pkgdown__ e divulgue seu trabalho #rstats, #rladies
--

+ Teste, cuide des usuÃ¡ries e da comunidade ao redor do pacote â¤ï¸



---
class: center, middle

# Â¡Obrigada!

<i class="fas  fa-paper-plane " style="color:#562457;"></i> [andreasancheztapia@gmail.com](mailto:andreasancheztapia@gmail.com) 

<i class="fab  fa-twitter " style="color:#562457;"></i> [@SanchezTapiaA](https://twitter.com/SanchezTapiaA) 

<i class="fab  fa-github " style="color:#562457;"></i> <i class="fab  fa-gitlab " style="color:#562457;"></i> <i class="fab  fa-bitbucket " style="color:#562457;"></i> [andreasancheztapia](http://github.com/andreasancheztapia) 

<i class="fab  fa-r-project " style="color:#562457;"></i> [R-Ladies+ Rio de Janeiro](https://www.meetup.com/pt-BR/rladies-rio/)

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
